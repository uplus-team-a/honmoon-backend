### 1) ì´ë©”ì¼/íŒ¨ìŠ¤ì›Œë“œ ë¡œê·¸ì¸ìœ¼ë¡œ ì„¸ì…˜ í† í° ë°œê¸‰
POST {{host}}/api/auth/login
Content-Type: application/json
Accept: application/json

{
  "email": "aekuya_@naver.com",
  "password": "dnjs2079577"
}

> {%
    client.test("ì´ë©”ì¼ ë¡œê·¸ì¸ - 200", () => {
        client.assert(response.status === 200, "Status must be 200 OK");
        client.assert(!!response.body.data.token, "token must exist");
    });
    const token = response.body.data.token;
    client.global.set("authToken", `Bearer ${token}`);
%}

### 2) PNG ì´ë¯¸ì§€ ì—…ë¡œë“œ URL ìƒì„±
POST {{host}}/api/images/upload-url?contentType=image/png
Accept: application/json
Authorization: {{authToken}}

> {%
    client.test("PNG ì´ë¯¸ì§€ ì—…ë¡œë“œ URL ìƒì„± - 200", () => {
        client.assert(response.status === 200, "Status must be 200 OK");
        client.assert(!!response.body.data.uploadUrl, "uploadUrl must exist");
        client.assert(!!response.body.data.fileName, "fileName must exist");
        client.assert(!!response.body.data.publicUrl, "publicUrl must exist");
        client.assert(response.body.data.fileName.endsWith(".png"), "fileName should have .png extension");
        client.assert(response.body.data.maxFileSizeMB === 10, "maxFileSizeMB should be 10");
        
        // íŒŒì¼ëª…ì´ ê°„ë‹¨í•´ì¡ŒëŠ”ì§€ í™•ì¸ (10ê¸€ì + _ + íƒ€ì„ìŠ¤íƒ¬í”„ + .í™•ì¥ì)
        const fileName = response.body.data.fileName;
        const fileNameWithoutExt = fileName.substring(0, fileName.lastIndexOf('.'));
        const parts = fileNameWithoutExt.split('_');
        client.assert(parts.length === 2, "fileName should have format: randomstring_timestamp.extension");
        client.assert(parts[0].length === 10, "random string should be 10 characters");
        
        // ë‹¤ìŒ ìš”ì²­ì„ ìœ„í•´ ì—…ë¡œë“œ URL ì €ì¥
        client.global.set("uploadUrl", response.body.data.uploadUrl);
        client.global.set("publicUrl", response.body.data.publicUrl);
    });
%}

### 3) JPEG ì´ë¯¸ì§€ ì—…ë¡œë“œ URL ìƒì„± (ì»¤ìŠ¤í…€ í¬ê¸° ì œí•œ)
POST {{host}}/api/images/upload-url?contentType=image/jpeg&maxSizeMB=20
Accept: application/json
Authorization: {{authToken}}

> {%
    client.test("JPEG ì´ë¯¸ì§€ ì—…ë¡œë“œ URL ìƒì„± (20MB) - 200", () => {
        client.assert(response.status === 200, "Status must be 200 OK");
        client.assert(!!response.body.data.uploadUrl, "uploadUrl must exist");
        client.assert(!!response.body.data.fileName, "fileName must exist");
        client.assert(!!response.body.data.publicUrl, "publicUrl must exist");
        client.assert(response.body.data.fileName.endsWith(".jpg"), "fileName should have .jpg extension");
        client.assert(response.body.data.maxFileSizeMB === 20, "maxFileSizeMB should be 20");
    });
%}

### 4) ê¸°ë³¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ URL ìƒì„± (contentType ì—†ìŒ)
POST {{host}}/api/images/upload-url
Accept: application/json
Authorization: {{authToken}}

> {%
    client.test("ê¸°ë³¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ URL ìƒì„± - 200", () => {
        client.assert(response.status === 200, "Status must be 200 OK");
        client.assert(!!response.body.data.uploadUrl, "uploadUrl must exist");
        client.assert(!!response.body.data.fileName, "fileName must exist");
        client.assert(!!response.body.data.publicUrl, "publicUrl must exist");
        client.assert(response.body.data.fileName.endsWith(".jpg"), "fileName should have default .jpg extension");
        client.assert(response.body.data.maxFileSizeMB === 10, "maxFileSizeMB should be default 10");
    });
%}

### 5) WebP ì´ë¯¸ì§€ ì—…ë¡œë“œ URL ìƒì„± (ì‘ì€ í¬ê¸° ì œí•œ)
POST {{host}}/api/images/upload-url?contentType=image/webp&maxSizeMB=5
Accept: application/json
Authorization: {{authToken}}

> {%
    client.test("WebP ì´ë¯¸ì§€ ì—…ë¡œë“œ URL ìƒì„± (5MB) - 200", () => {
        client.assert(response.status === 200, "Status must be 200 OK");
        client.assert(!!response.body.data.uploadUrl, "uploadUrl must exist");
        client.assert(!!response.body.data.fileName, "fileName must exist");
        client.assert(!!response.body.data.publicUrl, "publicUrl must exist");
        client.assert(response.body.data.fileName.endsWith(".webp"), "fileName should have .webp extension");
        client.assert(response.body.data.maxFileSizeMB === 5, "maxFileSizeMB should be 5");
    });
%}

###
# ğŸš€ Presigned URLì„ ì‚¬ìš©í•œ ì‹¤ì œ íŒŒì¼ ì—…ë¡œë“œ
# ìœ„ì—ì„œ ìƒì„±ëœ uploadUrlì„ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ GCP Storageì— ì—…ë¡œë“œ
#
# ì‚¬ìš©ë²•:
# 1. ìœ„ì˜ í…ŒìŠ¤íŠ¸ì—ì„œ uploadUrl ìƒì„±
# 2. ì•„ë˜ PUT ìš”ì²­ì— ì‹¤ì œ ì´ë¯¸ì§€ íŒŒì¼ ë°”ì´ë„ˆë¦¬ ë°ì´í„° ì²¨ë¶€
# 3. Content-Typeì„ í•´ë‹¹ ì´ë¯¸ì§€ íƒ€ì…ìœ¼ë¡œ ì„¤ì •
#
# PUT {{uploadUrl}}
# Content-Type: image/png
# [ì´ë¯¸ì§€ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ ì—¬ê¸°ì— ì²¨ë¶€]
#
# ë³€ê²½ì‚¬í•­:
# 1. GCP Storage V4 ì„œëª… ë°©ì‹ìœ¼ë¡œ ì˜¬ë°”ë¥¸ presigned URL ìƒì„±
# 2. íŒŒì¼ëª… ê°„ì†Œí™” (10ê¸€ì + íƒ€ì„ìŠ¤íƒ¬í”„)
# 3. ë§Œë£Œì‹œê°„ 60ë¶„ìœ¼ë¡œ ì¦ê°€
# 4. ìµœëŒ€ íŒŒì¼ í¬ê¸° 10MBë¡œ ì¦ê°€ (ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥)
# 5. PUT ë©”ì„œë“œë¡œ ì§ì ‘ GCP Storage ì—…ë¡œë“œ ì§€ì›
